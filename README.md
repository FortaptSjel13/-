# Проектирование витрины данных
## Ссылка на исходный датасет: https://www.kaggle.com/datasets/ealaxi/paysim1/data
**Содержание исходного датасета:** "PaySim имитирует мобильные финансовые транзакции на основе выборки реальных транзакций, извлеченных из финансовых журналов за один месяц работы сервиса мобильных платежей, работающего в одной из африканских стран. Оригинальные журналы были предоставлены международной компанией, являющейся поставщиком мобильного финансового сервиса, который в настоящее время доступен более чем в 14 странах мира".

## Цели проекта:
- Провести исследование исходного датасета, проверить на наличие аномалий.
- Построить ER-диаграмму и привести данные к 3НФ.
- Построить таблицы фактов и измерений через pandas.
- Создать БД и витрину данных в Postgres для анализа транзакций и отслеживания фродовой активности.
- Написать SQL скрипты для проверки корректности витрины.

## Содержание исходного датасета:
**Исходный датасет содержит более 6 млн строк с информацией о:**
- отправителях и получателях
- типах операций (TRANSFER, CASH_IN, PAYMENT, CASH_OUT, DEBIT)
- балансах отправителей и получателей до и после операции
- признаках мошенничества (is_fraud, is_flagged_fraud)

## 1. Подготовка исходного датасета 
- Проверены пропуски и дубликаты (не обнаружены)
- Исключены отрицательные суммы
- Выявлены аномалии:
    - Баланс отправителя после транзакции становится больше и равняется сумме транзакции. Принято решение оставить эти записи как особенность симуляции
    - В 1.2 млн строк баланс получателя после TRANSFER и CASH_IN стал меньше. Строки также сохранены для корректного анализа
    - Выявлено 1769 клиентов, которые бывают как отправителями, так и получателями

## 2. Построение ER-диаграммы и приведение данных к 3НФ
- Выделены три таблицы измерений (clients, dates, transaction_types)
- Построена ER-диаграмма в виде звездной схемы. **Изображение схемы хранится в папке images**
- Все колонки атомарны, нет множественных значений (1НФ)
- Все неключевые атрибуты (amount, old_balanse_orig, new_balance_orig, old_balance_dest, new_balanse_dest, is_fraud, is+flagged_fraud) зависят от всего первичного ключа (transaction_id), нет частичной зависимости (2НФ)
- Нет транзитивной зависимости между неключевыми атрибутами (3НФ)
## 3. Построение таблиц фактов и измерений
**На основе исходного датасета в pandas были подготовлены:**
  - Фактовая таблица **fact_transactions**, содержащая информацию о всех транзакциях с ключами на таблицы измерений
  - Измерения:
      - **clients** - справочник клиентов
      - **transaction_types** - справочник типов транзакций
      - **dates** - календарь по шагам (часы, дни недели, недели месяца)
## Таблицы фактов и измерений для БД хранятся на гугл диске: https://drive.google.com/drive/folders/1poCZl6WkuAf5IeXfT65Sl0jwLghnzYqV?usp=sharing
## 4. Загрузка данных в Postgres
- Создала БД в Postgres и подключилась к ней через DBeaver
- Создала таблицы измерений и фактов с ключами и ограничениями целосности, загрузила данные в таблицы и проверила их на корректность
- Настроены FK:
      - fact_transactions -> clients (orig\dest)
      - fact_transactions -> transaction_types
      - fact_transactions -> dates
<img width="1079" height="231" alt="image" src="https://github.com/user-attachments/assets/ea98dc32-4018-4b6a-afb5-a7f11fe4797c" />

- Для финансовых полей выбран тип NUMERIC(18,2), для флагов - BOOLEAN
- Добавлен surrogate key transaction_id SERIAL PRIMARY KEY

<img width="512" height="560" alt="image" src="https://github.com/user-attachments/assets/7f6f2617-ed12-489e-84f1-06c1eaafcf7e" />

## 5. Построение витрины и ее проверка
### Назничение витрины: 
Витрина агрегирует транзакции по времени и типам операции и позволяет:
- отслеживать динамику транзакций и финансовый оборот
- отслеживать пики фродовой активности
- анализировать частоту и долю мошеннических операций
- оценивать эффективность работы правил антифрод-системы.

<img width="752" height="573" alt="image" src="https://github.com/user-attachments/assets/106e8c7c-641e-4b69-b6e0-15731d2f3b79" />

Далее я проверила витрину на корректность:
- Сравнила количество строк с исходным датасетом.
- Проверила, что в fact_transaction и data_mart одинаковое кол-во транзакций, одинаковая сумма транзакций, одинаковое количество фродов
- Проверила, что в ключевых полях (hour_of_day, day_of_week, week_of_month, type_name) нет NULL
- Примеры выборочных SQL-запросов:

**В какое время суток больше всего фродовых операций?**

   <img width="729" height="703" alt="image" src="https://github.com/user-attachments/assets/c35bfd76-55d1-43f5-810e-93081b753eec" />

**В каких типах операций самый высокий риск?**

<img width="707" height="341" alt="image" src="https://github.com/user-attachments/assets/93303e6a-de82-4718-993e-988065a80b7d" />

**Насколько эффективно работает антифрод-система?**

<img width="665" height="318" alt="image" src="https://github.com/user-attachments/assets/fb2c2483-ee3b-4f08-ac10-79c9e1dde9ee" />

**Где по деньгам риск выше всего?**

<img width="580" height="370" alt="image" src="https://github.com/user-attachments/assets/1f9c44b0-a3ce-4bf5-94ae-94b1e0cb1e64" />

**Распределение количества транзакций по дням недели**

<img width="391" height="443" alt="image" src="https://github.com/user-attachments/assets/c860fcf9-b0d4-4798-abf5-13138dbf40cf" />

## Инструменты
- Python: pandas
- PostgreSQL: создание БД и витрины
- DBeaver: визуализация схемы и запросы
- GitHub: хранение кода и документации

## Итоги
  - Построена витрина данных по транзакциям на основе PaySim
  - Реализована звездная схема для удобства аналитики
  - Данные очищены и приведены к 3НФ
  - Настроена ссылочная целостность БД
  - Подготовлена база для анализа фродовой активности

## Выводы
  - Витрина обеспечивает удобный анализ транзакций по клиентам, времени и типам операций
  - Архитектура соответствует принципам построения DWH
  - Проект можно использовать как базу для задач BI-аналитики или ML по выявлению фрода
 
